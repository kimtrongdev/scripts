class Popup{constructor(){this.settingsPanel=document.querySelector(".top-settings-panel"),this.paramsList=document.querySelector(".params-list"),this.themeLink=document.querySelector("#theme-link"),this.storage=null,this.currentTab=null,this.audio=null,this.run()}run(){this.initStorage().then(()=>this.getCurrentTab()).then(()=>{this.showActiveSelect(),this.createAudio(),this.setTimePeriod(),this.setTimeInterval(),this.initializeBeautySelect(),this.setThemeMode(),this.fillSelectedParams(),this.initListeners()})}showActiveSelect(){const c=document.querySelector(".clearing-period"),a=document.querySelector(".clearing-interval");"off"===this.storage.timeInterval?(this.hideElement({element:a}),this.showElement({element:c})):(this.hideElement({element:c}),this.showElement({element:a}))}createAudio(){const b=chrome.runtime.getURL("audios/accomplished.mp3");this.audio=new Audio(b),this.audio.loop=!1}getCurrentTab(){return new Promise(c=>{chrome.tabs.query({active:!0,currentWindow:!0},a=>{this.currentTab=a[0],c()})})}setTimePeriod(){const b=document.querySelector(".time-period-select");b.value=this.storage.timePeriod}setTimeInterval(){const b=document.querySelector(".time-interval-select");b.value=this.storage.timeInterval}initializeBeautySelect(){$(document).ready(function(){$(".time-period-select").niceSelect(),$(".time-interval-select").niceSelect()})}initStorage(){return new Promise(c=>{chrome.storage.local.get(a=>{this.storage=a,c()})})}fillSelectedParams(){const b=JSON.parse(this.storage.dataToRemove);b.forEach(c=>{const a=document.querySelector(`#${c}`);a&&(a.checked=!0)})}setThemeMode(){const c=this.storage.theme;let d;if("light"===c)d=chrome.runtime.getURL("css/popup/popup_light.css");else{d=chrome.runtime.getURL("css/popup/popup_dark.css");const b=document.querySelector(".dark-theme-toggling");b.classList.add("dark")}this.themeLink.href=d}initListeners(){this.initStorageListeners(),this.initDomListeners()}initStorageListeners(){chrome.storage.onChanged.addListener(b=>this.handleStorageChanges(b))}handleStorageChanges(c){const a=Object.keys(c);a.forEach(a=>{this.storage[a]=c[a].newValue})}initDomListeners(){this.settingsPanel.addEventListener("click",b=>this.handleSettingsPanelClick(b)),$(".clearing-period").on("change","select",b=>{chrome.storage.local.set({timePeriod:b.target.value},()=>{})}),$(".clearing-interval").on("change","select",b=>{chrome.storage.local.set({timeInterval:b.target.value},()=>{})}),$(".input-part input").on("change",b=>{this.handleSingleChekingChange(b)}),$(".control-item").on("click",b=>{this.handleControlElement(b)}),$(".clear-btn").on("click",b=>this.handleClearBtn(b))}handleSettingsPanelClick(d){const a=d.target,b=a.dataset.action;if(b)switch(b){case"all-selecting":this.handleAllSelectionSwitch(a);break;case"toggle-theme":this.handleThemeChange(a);break;case"open-options":this.showOptionsLink();break;default:}}handleAllSelectionSwitch(d){d.classList.toggle("all-selected");const e=d.classList.contains("all-selected"),a=Array.from(this.paramsList.querySelectorAll("input"));a.forEach(b=>{b.checked=e;const a=b.id,c=e?"push":"splice";this.modifyDataToRemoveList(c,a)}),chrome.storage.local.set({dataToRemove:this.storage.dataToRemove},()=>{})}modifyDataToRemoveList(e,a){const b=JSON.parse(this.storage.dataToRemove),c=b.indexOf(a);if("push"===e&&0>c)b.push(a);else{if(0>c)return;b.splice(c,1)}this.storage.dataToRemove=JSON.stringify(b)}handleThemeChange(d){d.classList.toggle("dark");const a=d.classList.contains("dark");this.themeLink.href=a?chrome.runtime.getURL("css/popup/popup_dark.css"):chrome.runtime.getURL("css/popup/popup_light.css");const b=a?"dark":"light";chrome.storage.local.set({theme:b},()=>{})}showOptionsLink(){const e=chrome.runtime.getURL("options.html");chrome.tabs.query({currentWindow:!0},a=>{let f=!1,g=null;a.forEach(a=>{a.url!==e||(f=!0,g=a.id)}),f?chrome.tabs.update(g,{highlighted:!0},()=>{}):chrome.tabs.create({url:e},()=>{})})}handleSingleChekingChange(f){const a=f.target.id,b=f.target.checked,c=JSON.parse(this.storage.dataToRemove),d=c.indexOf(a);b&&0>d?c.push(a):-1<d&&c.splice(d,1),this.storage.dataToRemove=JSON.stringify(c),chrome.storage.local.set({dataToRemove:this.storage.dataToRemove},()=>{})}handleControlElement(c){const d=c.target;if(d.dataset.page_link){const b=d.dataset.page_link;return void chrome.tabs.create({url:b},()=>{})}this.removeSingleParamInfo(c.target)}removeSingleParamInfo(c){if(!(c.classList.contains("animated")||c.classList.contains("scaled"))){const a=c.dataset.param;return a?"passwords"===a?void this.tryToRemovePasswords():void chrome.runtime.sendMessage({action:"clear",tab:this.currentTab,removeObject:{[a]:!0}},()=>{this.animateDeleteControlButton(c)}):void 0}}animateDeleteControlButton(b){b.classList.add("scaled"),this.audio.volume=this.storage.audio?1:0,this.audio.play(),this.animateSingleDeleting(b)}animateSingleDeleting(c){return new Promise(a=>{c.classList.add("scaled"),setTimeout(()=>{c.classList.remove("scaled"),c.classList.add("animated"),a(c)},300)}).then(b=>{setTimeout(()=>{b.classList.remove("animated")},2e3)})}tryToRemovePasswords(){this.acceptPasswordDeleting().then(b=>{if(this.deleteCurrentWindow(),"ok"===b)chrome.runtime.sendMessage({action:"clear",tab:this.currentTab,removeObject:{passwords:!0}},()=>{});else;})}acceptPasswordDeleting(){return new Promise((c,a)=>{this.createDialogWindow("passwords",c,a)})}createDialogWindow(e,a){const b={passwords:"Passwords will be cleared.<br /> Are you sure?",—ÅhosenElems:"Please, confirm data removing"}[e],c=this.createDialog(b);this.addDialogListeners(c,a),document.body.appendChild(c)}createDialog(c){const a=document.createRange().createContextualFragment(`		<section class="dialog-window" id="chosen-elems-accepting">			<div class="dialog-window-item">				<h2 class="dialog-header">${c}</h2>				<div class="control-buttons">					<span class="ok">ok</span>					<span class="cancel">cancel</span>				</div>			</div>		</section>		`);return a}addDialogListeners(e,a){const b=e.querySelector(".ok"),c=e.querySelector(".cancel");b.addEventListener("click",()=>a("ok")),c.addEventListener("click",()=>a("cancel"))}deleteCurrentWindow(){const b=document.querySelector(".dialog-window");b.remove()}handleClearBtn(){const e=JSON.parse(this.storage.dataToRemove),f={};e.forEach(b=>f[b]=!0);const a=e.includes("passwords"),b=Object.keys(f).length;a?1===b?this.acceptPasswordDeleting().then(b=>{this.deleteCurrentWindow(),"cancel"===b||chrome.runtime.sendMessage({action:"clear",tab:this.currentTab,removeObject:f},()=>{this.showSuccessDeletingStatus()})}):this.acceptPasswordDeleting().then(b=>{this.deleteCurrentWindow(),"cancel"===b&&delete f.passwords,chrome.runtime.sendMessage({action:"clear",tab:this.currentTab,removeObject:f},()=>{this.showSuccessDeletingStatus()})}):chrome.runtime.sendMessage({action:"clear",tab:this.currentTab,removeObject:f},()=>{this.showSuccessDeletingStatus()})}showSuccessDeletingStatus(){const f=document.querySelector(".clear-btn"),a=f.className.split(" ");if(a.includes("animated"))return;const b=f.querySelector(".clear-btn_text"),c=f.querySelector(".success_img"),d=f.querySelector(".top_layer");this.hideElement({element:b}),f.classList.add("animated"),this.audio.volume=this.storage.audio?1:0,this.audio.play(),new Promise(b=>{setTimeout(()=>{this.showElement({element:c}),this.hideElement({element:d}),this.audio.pause(),this.audio.currentTime=0,b()},800)}).then(()=>{setTimeout(()=>{this.hideElement({element:c}),this.showElement({element:b}),this.showElement({element:d}),f.classList.remove("animated")},1e3)})}showElement(b){b&&"object"==typeof b&&Object.keys(b).length&&(b.element?b.element.classList.remove("hidden"):b.selector&&document.querySelector(b.selector).classList.remove("hidden"))}hideElement(b){b&&"object"==typeof b&&Object.keys(b).length&&(b.element?b.element.classList.add("hidden"):b.selector&&document.querySelector(b.selector).classList.add("hidden"))}acceptDeleteCheckedParams(){return new Promise((c,a)=>{this.createDialogWindow("\u0441hosenElems",c,a)})}}const guruPopup=new Popup;